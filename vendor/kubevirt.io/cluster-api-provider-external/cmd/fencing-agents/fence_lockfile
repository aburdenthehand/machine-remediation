#!/bin/bash

target="none"
lockdir="/tmp"
action="status"
for arg in $*; do
    case $arg in
	-x) set -x; shift;;
	-d|--lockdir) lockdir=$2; shift; shift;;
	-t|--target)  target=$2; shift; shift;;
	-o|--action)  action=$2; shift; shift;;
	esac
done

lockfile="$lockdir/$target.lock"

case $action in
	status) 
		if [ ! -e "$lockfile" ]; then
			exit 1
		fi
		;;
	on) date >> "$lockfile"    
		;;
	off)    
		rm -f "$lockfile"
		;;
	*) exit 2
esac

exit 0